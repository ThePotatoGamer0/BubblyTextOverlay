<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customizable OBS Overlay</title>
    
    <!-- Adding more Google Fonts so we can change them via URL -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Lato:wght@400;700;900&family=Montserrat:wght@400;700;900&family=Oswald:wght@400;700&family=Roboto:wght@400;700;900&family=Source+Code+Pro:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            background-color: rgba(0, 0, 0, 0);
            margin: 0;
            padding-left: 0;
            /* A small default top padding, will be overridden by JS */
            padding-top: 10px; 
            overflow: hidden;
            font-family: 'Inter', sans-serif;
            color: white;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.8);
        }

        #animated-text {
            font-size: 80px; 
            display: flex;
            flex-wrap: wrap;
            justify-content: left; 
            align-items: top;
            text-align: left;
            margin-left: 0;
            padding-left: 0;
        }

        #animated-text span {
            display: inline-block;
            min-width: 0.3em;
        }
    </style>
</head>
<body>

    <div id="animated-text"></div>

    <script type="module">
        import { animate, stagger } from "https://cdn.jsdelivr.net/npm/motion@latest/+esm";

        // --- Step 1: Get all parameters from the URL with sensible defaults ---
        const urlParams = new URLSearchParams(window.location.search);

        // Text & Style Parameters
        const text = urlParams.get('text') || "Hello World";
        const fontFamily = urlParams.get('fontFamily') || "'Inter', sans-serif";
        const fontSize = urlParams.get('fontSize') || '80'; // in pixels
        const fontWeight = urlParams.get('fontWeight') || 'bold';
        const color = urlParams.get('color') || 'white';
        const customFontUrl = urlParams.get('customFontUrl');
        
        // Animation Parameters
        const duration = parseFloat(urlParams.get('duration') || '1.5');
        const staggerDelay = parseFloat(urlParams.get('stagger') || '0.05');
        const bounceHeight = urlParams.get('bounce') || '-40'; // percentage
        
        // --- NEW: Calculate dynamic top padding ---
        // We take the absolute value of bounceHeight (e.g., -40 becomes 40)
        // Then we calculate that percentage of the font size to get a pixel value
        const bounceHeightPercent = Math.abs(parseFloat(bounceHeight));
        const paddingTop = (parseFloat(fontSize) * (bounceHeightPercent / 100));
        document.body.style.paddingTop = `${paddingTop}px`;
        
        // --- Step 2: Apply the dynamic styles to the text container ---
        const textContainer = document.querySelector('#animated-text');
        
        if (customFontUrl) {
            const style = document.createElement('style');
            style.textContent = `
                @font-face {
                    font-family: 'CustomFont';
                    src: url('${decodeURIComponent(customFontUrl)}');
                }
            `;
            document.head.appendChild(style);
            textContainer.style.fontFamily = "'CustomFont', sans-serif";
        } else {
            textContainer.style.fontFamily = fontFamily;
        }
        
        textContainer.style.fontSize = `${fontSize}px`;
        textContainer.style.fontWeight = fontWeight;
        textContainer.style.color = color;


        // --- Step 3: Split the text into individual letter spans ---
        textContainer.textContent = text; 
        const originalText = textContainer.textContent;
        textContainer.textContent = ''; 

        originalText.split('').forEach(char => {
            const span = document.createElement('span');
            span.innerHTML = char === ' ' ? '&nbsp;' : char;
            textContainer.appendChild(span);
        });


        // --- Step 4: Animate using the dynamic parameters ---
        const spans = document.querySelectorAll('#animated-text span');

        animate(
            spans,
            {
                y: ["0%", `${bounceHeight}%`, "0%"]
            },
            {
                duration: duration,
                delay: stagger(staggerDelay),
                repeat: Infinity,
                easing: "ease-in-out"
            }
        );
    </script>
</body>
</html>